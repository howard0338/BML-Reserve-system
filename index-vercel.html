<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BMLÈ†êÁ¥ÑÁ≥ªÁµ±</title>
    <link rel="stylesheet" href="styles.css">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    
    <!-- Firebase SDK -->
    <script type="module">
        import { 
            db, 
            auth, 
            ref, 
            set, 
            get, 
            onValue, 
            push, 
            remove, 
            signInAnonymously, 
            onAuthStateChanged,
            writeReservation,
            readAllReservations,
            listenToReservations,
            writeInstruments,
            readInstruments,
            listenToInstruments
        } from './firebase.js';
        
        function initFirebase() {
            console.log('üöÄ ÈñãÂßãÂàùÂßãÂåñFirebase...');
            
            try {
                // Â∞áFirebaseÂäüËÉΩË®≠ÁÇ∫ÂÖ®ÂüüËÆäÊï∏
                window.firebase = {
                    database: db,
                    auth,
                    ref,
                    set,
                    get,
                    onValue,
                    push,
                    remove,
                    signInAnonymously,
                    onAuthStateChanged,
                    writeReservation,
                    readAllReservations,
                    listenToReservations,
                    writeInstruments,
                    readInstruments,
                    listenToInstruments
                };
                
                console.log('‚úÖ FirebaseÂàùÂßãÂåñÊàêÂäü');
                console.log('üìä FirebaseÂäüËÉΩÂ∑≤ËºâÂÖ•:', Object.keys(window.firebase));
                
                // Á´ãÂç≥Ëß∏Áôºready‰∫ã‰ª∂ÔºåËÆìÁ≥ªÁµ±ÈñãÂßãÈÅãË°å
                setTimeout(() => {
                    console.log('‚úÖ Ëß∏ÁôºfirebaseReady‰∫ã‰ª∂');
                    window.dispatchEvent(new CustomEvent('firebaseReady'));
                }, 1000);
                
            } catch (error) {
                console.error('‚ùå FirebaseÂàùÂßãÂåñÂ§±Êïó:', error);
                // Âç≥‰ΩøÂ§±Êïó‰πüËß∏Áôºready‰∫ã‰ª∂
                setTimeout(() => {
                    window.dispatchEvent(new CustomEvent('firebaseReady'));
                }, 1000);
            }
        }
        
        // È†ÅÈù¢ËºâÂÖ•ÊôÇÂàùÂßãÂåñFirebase
        initFirebase();
    </script>
</head>
<body>
    <div class="container">
        <!-- Ê®ôÈ°åÂàó -->
        <header class="header">
            <h1>BMLÈ†êÁ¥ÑÁ≥ªÁµ±</h1>
            <div class="author-info">designed by ‰∏ñÂíå</div>
            <div id="connectionStatus" class="connection-status connecting">
                <span>ÈÄ£Á∑ö‰∏≠...</span>
            </div>
        </header>

        <!-- ‰∏ªË¶ÅÂÖßÂÆπÂçÄÂüü -->
        <div class="main-content">
            <!-- Â∑¶ÂÅ¥ÔºöÂÑÄÂô®ÂàóË°® -->
            <div class="instruments-panel">
                <div class="panel-header">
                    <h2>ÂÑÄÂô®ÂàóË°®</h2>
                    <button id="addInstrumentBtn" class="btn btn-primary">
                        <i class="fas fa-plus"></i> Êñ∞Â¢ûÂÑÄÂô®
                    </button>
                </div>
                <div id="instrumentsList" class="instruments-list">
                    <!-- ÂÑÄÂô®È†ÖÁõÆÂ∞áÂú®ÈÄôË£°ÂãïÊÖãÁîüÊàê -->
                </div>
            </div>

            <!-- Âè≥ÂÅ¥ÔºöÈ†êÁ¥ÑÊéíÁ®ã -->
            <div class="schedule-panel">
                <div class="panel-header">
                    <h2>È†êÁ¥ÑÊéíÁ®ã</h2>
                    <div class="schedule-controls">
                        <button id="viewHistoryBtn" class="btn btn-secondary">
                            <i class="fas fa-history"></i> Êü•ÁúãÊ≠∑Âè≤
                        </button>
                    </div>
                </div>
                <div class="schedule-content">
                    <div class="week-schedule">
                        <h3 class="week-title">Êú¨ÈÄ±</h3>
                        <div id="scheduleTable" class="schedule-table">
                            <!-- ÊéíÁ®ãË°®Ê†ºÂ∞áÂú®ÈÄôË£°ÂãïÊÖãÁîüÊàê -->
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Êñ∞Â¢ûÂÑÄÂô®Ê®°ÊÖãÊ°Ü -->
    <div id="addInstrumentModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Êñ∞Â¢ûÂÑÄÂô®</h3>
                <span class="close">&times;</span>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label for="instrumentName">ÂÑÄÂô®ÂêçÁ®±Ôºö</label>
                    <input type="text" id="instrumentName" required>
                </div>
                <div class="form-group">
                    <label for="instrumentDescription">ÂÑÄÂô®ÊèèËø∞Ôºö</label>
                    <textarea id="instrumentDescription" rows="3"></textarea>
                </div>
                <div class="form-group">
                    <label for="instrumentLocation">Âú∞ÂùÄÔºö</label>
                    <input type="text" id="instrumentLocation" required>
                </div>
            </div>
            <div class="modal-footer">
                <button id="deleteInstrument" class="btn btn-danger" style="display: none;">Âà™Èô§ÂÑÄÂô®</button>
                <button id="cancelAddInstrument" class="btn btn-secondary">ÂèñÊ∂à</button>
                <button id="saveInstrument" class="btn btn-primary">ÂÑ≤Â≠ò</button>
            </div>
        </div>
    </div>

    <!-- È†êÁ¥ÑÊ®°ÊÖãÊ°Ü -->
    <div id="bookingModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Á∑®ËºØÈ†êÁ¥Ñ</h3>
                <span class="close">&times;</span>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label for="bookingInstrument">ÂÑÄÂô®Ôºö</label>
                    <select id="bookingInstrument" required></select>
                </div>
                <div class="form-group">
                    <label for="bookingContactName">È†êÁ¥Ñ‰∫∫Ôºö</label>
                    <input type="text" id="bookingContactName" required>
                </div>
                <div class="form-group">
                    <label for="bookingDate">Êó•ÊúüÔºö</label>
                    <input type="date" id="bookingDate" required>
                </div>
                <div class="form-group">
                    <label for="bookingTime">ÊôÇÊÆµÔºö</label>
                    <select id="bookingTime" required>
                        <option value="‰∏äÂçà">‰∏äÂçà</option>
                        <option value="‰∏ãÂçà">‰∏ãÂçà</option>
                        <option value="Êôö‰∏ä">Êôö‰∏ä</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="bookingPurpose">Áî®ÈÄîÔºö</label>
                    <textarea id="bookingPurpose" rows="3"></textarea>
                </div>
            </div>
            <div class="modal-footer">
                <button id="deleteBooking" class="btn btn-danger" style="display: none;">Âà™Èô§È†êÁ¥Ñ</button>
                <button id="cancelBooking" class="btn btn-secondary">ÂèñÊ∂à</button>
                <button id="saveBooking" class="btn btn-primary">ÂÑ≤Â≠ò</button>
            </div>
        </div>
    </div>

    <!-- Ê≠∑Âè≤Ë®òÈåÑÊ®°ÊÖãÊ°Ü -->
    <div id="historyModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>È†êÁ¥ÑÊ≠∑Âè≤Ë®òÈåÑ</h3>
                <span class="close">&times;</span>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label for="historyFilter">ÁØ©ÈÅ∏Ôºö</label>
                    <select id="historyFilter">
                        <option value="all">ÊâÄÊúâÂÑÄÂô®</option>
                    </select>
                    <button id="filterHistory" class="btn btn-primary">ÁØ©ÈÅ∏</button>
                </div>
                <div id="historyList" class="history-list">
                    <!-- Ê≠∑Âè≤Ë®òÈåÑÂ∞áÂú®ÈÄôË£°ÂãïÊÖãÁîüÊàê -->
                </div>
            </div>
        </div>
    </div>

    <!-- Ë®äÊÅØÊèêÁ§∫ -->
    <div id="messageContainer" class="message-container"></div>

    <!-- ËºâÂÖ•‰∏ªÁ®ãÂºè -->
    <script src="script.js"></script>
</body>
</html>
